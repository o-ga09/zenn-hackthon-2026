# 旅行Vlog自動生成エージェント - 機能要件

## 2. 機能要件

### 2.1 必須機能（MVP）

#### 2.1.1 メディアアップロード

- **機能:** ユーザーが画像・動画をアップロード
- **入力形式:** JPEG, PNG, MP4, MOV
- **制限:**
  - 最大10ファイル
  - 1ファイルあたり最大50MB
  - 合計最大200MB

#### 2.1.2 AIエージェント自動生成

- **機能:** Firebase Genkit for GoベースのAIエージェントが以下を自律的に実行
  1. メディアをCloudflare R2にアップロード
  2. Vertex AI（Gemini 3）でメディア内容・感情・ストーリーを分析
  3. Veo3で動画またはスライドショー（Instagramストーリー形式）を生成
  4. ずんだもん音声合成とFFmpegで最終動画を生成
  5. 共有URLを生成
- **技術スタック:** Firebase Genkit for Go + Vertex AI (Gemini 3) + Veo3
- **処理方式:** 非同期処理 + SSE（Server-Sent Events）によるリアルタイム進行状況通知

#### 2.1.3 進捗表示

- **機能:** AIエージェントの実行状況をリアルタイム表示
- **表示内容:**
  - 現在実行中のステップ
  - 各ステップの完了状態
  - エージェントの思考プロセス（「画像を分析中...」など）
  - エラー発生時のメッセージ

#### 2.1.4 動画再生・ダウンロード

- **機能:** 生成された動画をその場で再生・ダウンロード
- **形式:** MP4（H.264, AAC）
- **解像度:** 1920x1080 (Full HD)

#### 2.1.5 自動字幕生成

- **機能:** AIが生成したスクリプトを字幕として動画に埋め込み
- **フォーマット:** SRT形式で内部管理、動画にバーンイン

### 2.2 課金・プラン機能（必須）

#### 2.2.1 トークンベース課金システム

- **機能:** トークン単位でコンテンツ生成を管理
- **トークン消費:**
  - 画像1枚の分析: 10トークン
  - 動画1本の生成（1分）: 100トークン
  - スクリプト生成: 20トークン
  - 音声合成（10秒）: 15トークン
- **トークン購入:**
  - 100トークン: ¥980
  - 500トークン: ¥4,500（10%オフ）
  - 1,000トークン: ¥8,000（20%オフ）

#### 2.2.2 プラン管理

**フリープラン:**

- 月間50トークン無料
- 動画は最大30秒
- 透かしあり
- 共有機能制限

**月額プラン (¥1,980/月):**

- 月間300トークン付与
- 動画は最大3分
- 透かしなし
- 優先処理（待ち時間短縮）
- 全機能利用可能

**年額プラン (¥19,800/年):**

- 月額プランの2ヶ月分お得
- 月間300トークン付与（年間3,600トークン）
- 動画は最大5分
- 透かしなし
- 最優先処理
- 全機能利用可能
- ボーナストークン500付与

**従量課金:**

- トークン消費分のみ課金
- 1トークン = ¥10
- プラン契約なしで利用可能
- 動画は最大1分
- 透かしあり

#### 2.2.3 決済機能

- **決済方法:**
  - クレジットカード（Stripe）
- **請求管理:**
  - 利用履歴の確認
  - 請求書のダウンロード
  - 自動更新の管理

#### 2.2.4 トークン管理

- **機能:**
  - 残トークン数の表示
  - トークン消費履歴
  - トークン有効期限管理（購入から1年間）
  - 不足時の通知・購入促進

### 2.3 オプション機能（Phase 2）

#### 2.3.1 字幕編集

- **機能:** 生成された字幕を編集可能に
- **編集項目:**
  - テキスト内容
  - 表示タイミング
  - フォント、サイズ、色

#### 2.3.2 動画共有

- **機能:** 生成した動画を外部に共有
- **共有方法:**
  - 公開URLの発行
  - Twitter/X、Instagram用の最適化
  - QRコード生成

#### 2.3.3 テンプレート選択

- **機能:** 動画スタイルのテンプレート選択
- **テンプレート例:**
  - アクティブ（元気な旅行）
  - リラックス（癒しの旅行）
  - アドベンチャー（冒険の旅行）
